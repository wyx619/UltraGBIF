<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Set master digital voucher — set_digital_voucher • UltraGBIF</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Set master digital voucher — set_digital_voucher"><meta name="description" content="

Grouping Duplicates and Selecting the Digital Voucher


1. Handling Complete Collection Event Keys


Unique collection events often generate multiple duplicate GBIF records. One duplicate is designated as the master digital voucher, integrating data from other duplicates.
When the collection event key is complete, duplicates are grouped and parsed based on record completeness and geospatial quality:
Record Completeness : Assessed using data-quality scores for fields: recordedBy, recordNumber, year, institutionCode, catalogNumber, locality, municipality, countryCode, stateProvince, and fieldNotes.
Geospatial Quality : Ranked via a score derived from geospatial issues in EnumOccurrenceIssue (GBIF table).

The duplicate with the highest total score (sum of record completeness + geospatial quality) is assigned as the master voucher. Missing data from other duplicates are merged into this voucher.





2. Handling Incomplete Collection Event Keys


When the collection event key is incomplete, duplicates cannot be parsed. Each record is treated as a unique collection event, with no duplicates identified.
Record completeness and geospatial quality are still evaluated as described below to assess data integrity.





3. Quality Score Calculation


UltraGBIF_digital_voucher : The duplicate with the highest total score, calculated as






Total Score = Record Completeness + Quality of Geospatial Information


4. Record Completeness Calculation


Measured as the sum of binary flags (TRUE = 1, FALSE = 0) for the following fields:
Is recordedBy present?
Is recordNumber present?
Is year present?
Is institutionCode present?
Is catalogNumber present?
Is locality present?
Is municipality present?
Is countryCode present?
Is stateProvince present?
Is fieldNotes present?






5. Geospatial Quality Calculation


Based on GBIF geospatial issues in EnumOccurrenceIssue, classified into three categories:
No Impact : Issues not affecting coordinate accuracy (selection_score = -1).
Potential Impact : Issues that may affect coordinate accuracy (selection_score = -3).
Exclusion : Records with severe issues (selection_score = -9) are excluded.



This optimized version eliminates O(n²) complexity by using vectorized data.table operations.




"><meta property="og:description" content="

Grouping Duplicates and Selecting the Digital Voucher


1. Handling Complete Collection Event Keys


Unique collection events often generate multiple duplicate GBIF records. One duplicate is designated as the master digital voucher, integrating data from other duplicates.
When the collection event key is complete, duplicates are grouped and parsed based on record completeness and geospatial quality:
Record Completeness : Assessed using data-quality scores for fields: recordedBy, recordNumber, year, institutionCode, catalogNumber, locality, municipality, countryCode, stateProvince, and fieldNotes.
Geospatial Quality : Ranked via a score derived from geospatial issues in EnumOccurrenceIssue (GBIF table).

The duplicate with the highest total score (sum of record completeness + geospatial quality) is assigned as the master voucher. Missing data from other duplicates are merged into this voucher.





2. Handling Incomplete Collection Event Keys


When the collection event key is incomplete, duplicates cannot be parsed. Each record is treated as a unique collection event, with no duplicates identified.
Record completeness and geospatial quality are still evaluated as described below to assess data integrity.





3. Quality Score Calculation


UltraGBIF_digital_voucher : The duplicate with the highest total score, calculated as






Total Score = Record Completeness + Quality of Geospatial Information


4. Record Completeness Calculation


Measured as the sum of binary flags (TRUE = 1, FALSE = 0) for the following fields:
Is recordedBy present?
Is recordNumber present?
Is year present?
Is institutionCode present?
Is catalogNumber present?
Is locality present?
Is municipality present?
Is countryCode present?
Is stateProvince present?
Is fieldNotes present?






5. Geospatial Quality Calculation


Based on GBIF geospatial issues in EnumOccurrenceIssue, classified into three categories:
No Impact : Issues not affecting coordinate accuracy (selection_score = -1).
Potential Impact : Issues that may affect coordinate accuracy (selection_score = -3).
Exclusion : Records with severe issues (selection_score = -9) are excluded.



This optimized version eliminates O(n²) complexity by using vectorized data.table operations.




"><meta property="og:image" content="https://wyx619.github.io/UltraGBIF/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">UltraGBIF</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">3.0.7</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/Tutorial_of_UltraGBIF.html">Tutorial of UltraGBIF</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/wyx619/UltraGBIF/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Set master digital voucher</h1>
      <small class="dont-index">Source: <a href="https://github.com/wyx619/UltraGBIF/blob/HEAD/R/set_digital_voucher.R" class="external-link"><code>R/set_digital_voucher.R</code></a></small>
      <div class="d-none name"><code>set_digital_voucher.Rd</code></div>
    </div>

    <div class="ref-description section level2">

<div class="section">
<h3 id="grouping-duplicates-and-selecting-the-digital-voucher">Grouping Duplicates and Selecting the Digital Voucher<a class="anchor" aria-label="anchor" href="#grouping-duplicates-and-selecting-the-digital-voucher"></a></h3>

<div class="section">
<h4 id="-handling-complete-collection-event-keys">1. Handling Complete Collection Event Keys<a class="anchor" aria-label="anchor" href="#-handling-complete-collection-event-keys"></a></h4>

<ul><li><p>Unique collection events often generate multiple duplicate GBIF records. One duplicate is designated as the master digital voucher, integrating data from other duplicates.</p></li>
<li><p>When the collection event key is complete, duplicates are grouped and parsed based on record completeness and geospatial quality:</p><ul><li><p><em>Record Completeness</em> : Assessed using data-quality scores for fields: <code>recordedBy</code>, <code>recordNumber</code>, <code>year</code>, <code>institutionCode</code>, <code>catalogNumber</code>, <code>locality</code>, <code>municipality</code>, <code>countryCode</code>, <code>stateProvince</code>, and <code>fieldNotes</code>.</p></li>
<li><p><em>Geospatial Quality</em> : Ranked via a score derived from geospatial issues in <code>EnumOccurrenceIssue</code> (GBIF table).</p></li>
</ul></li>
<li><p>The duplicate with the highest total score (sum of record completeness + geospatial quality) is assigned as the master voucher. Missing data from other duplicates are merged into this voucher.</p></li>
</ul></div>

<div class="section">
<h4 id="-handling-incomplete-collection-event-keys">2. Handling Incomplete Collection Event Keys<a class="anchor" aria-label="anchor" href="#-handling-incomplete-collection-event-keys"></a></h4>

<ul><li><p>When the collection event key is incomplete, duplicates cannot be parsed. Each record is treated as a unique collection event, with no duplicates identified.</p></li>
<li><p>Record completeness and geospatial quality are still evaluated as described below to assess data integrity.</p></li>
</ul></div>

<div class="section">
<h4 id="-quality-score-calculation">3. Quality Score Calculation<a class="anchor" aria-label="anchor" href="#-quality-score-calculation"></a></h4>


<p><strong>UltraGBIF_digital_voucher</strong> : The duplicate with the highest total score, calculated as</p>
</div>


</div>

<div class="section">
<h3 id="total-score-record-completeness-quality-of-geospatial-information">Total Score = Record Completeness + Quality of Geospatial Information<a class="anchor" aria-label="anchor" href="#total-score-record-completeness-quality-of-geospatial-information"></a></h3>

<div class="section">
<h4 id="-record-completeness-calculation">4. Record Completeness Calculation<a class="anchor" aria-label="anchor" href="#-record-completeness-calculation"></a></h4>

<ul><li><p>Measured as the sum of binary flags (TRUE = 1, FALSE = 0) for the following fields:</p><ul><li><p>Is <code>recordedBy</code> present?</p></li>
<li><p>Is <code>recordNumber</code> present?</p></li>
<li><p>Is <code>year</code> present?</p></li>
<li><p>Is <code>institutionCode</code> present?</p></li>
<li><p>Is <code>catalogNumber</code> present?</p></li>
<li><p>Is <code>locality</code> present?</p></li>
<li><p>Is <code>municipality</code> present?</p></li>
<li><p>Is <code>countryCode</code> present?</p></li>
<li><p>Is <code>stateProvince</code> present?</p></li>
<li><p>Is <code>fieldNotes</code> present?</p></li>
</ul></li>
</ul></div>

<div class="section">
<h4 id="-geospatial-quality-calculation">5. Geospatial Quality Calculation<a class="anchor" aria-label="anchor" href="#-geospatial-quality-calculation"></a></h4>

<ul><li><p>Based on GBIF geospatial issues in <code>EnumOccurrenceIssue</code>, classified into three categories:</p><ul><li><p><em>No Impact</em> : Issues not affecting coordinate accuracy (<code>selection_score = -1</code>).</p></li>
<li><p><em>Potential Impact</em> : Issues that may affect coordinate accuracy (<code>selection_score = -3</code>).</p></li>
<li><p><em>Exclusion</em> : Records with severe issues (<code>selection_score = -9</code>) are excluded.</p></li>
</ul></li>
</ul><p><strong>This optimized version eliminates O(n²) complexity by using vectorized data.table operations.</strong></p>
</div>


</div>

    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">set_digital_voucher</span><span class="op">(</span>occ_import <span class="op">=</span> <span class="cn">NA</span>, names.checked <span class="op">=</span> <span class="cn">NA</span>, collection_key <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-occ-import">occ_import<a class="anchor" aria-label="anchor" href="#arg-occ-import"></a></dt>
<dd><p>imported GBIF records</p></dd>


<dt id="arg-names-checked">names.checked<a class="anchor" aria-label="anchor" href="#arg-names-checked"></a></dt>
<dd><p>your checked taxon names from <code>check_occ_name</code></p></dd>


<dt id="arg-collection-key">collection_key<a class="anchor" aria-label="anchor" href="#arg-collection-key"></a></dt>
<dd><p>your collection mark from <code>generate_collection_mark</code></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list with duration and 2 data.table:
"occ_digital_voucher" for all data processing fields and "occ_results" for only result fields.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>UltraGBIF_duplicates_grouping_status</code> :</p><ul><li><p><code>groupable</code>: Complete key, duplicates parsed.</p></li>
<li><p><code>not groupable: no recordedBy and no recordNumber</code>: Missing both fields.</p></li>
<li><p><code>not groupable: no recordNumber</code>: Missing recordNumber.</p></li>
<li><p><code>not groupable: no recordedBy</code>: Missing recordedBy.</p></li>
</ul><p><code>UltraGBIF_num_duplicates</code>: Integer count of duplicate records.</p>
<p><code>UltraGBIF_duplicates</code>: TRUE if duplicates exist, FALSE otherwise.</p>
<p><code>UltraGBIF_non_groupable_duplicates</code>: TRUE if duplicates cannot be grouped, FALSE otherwise.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/help.html" class="external-link">help</a></span><span class="op">(</span><span class="va">set_digital_voucher</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Rendering development documentation for <span style="color: #0000BB;">"set_digital_voucher"</span></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Yuxuan Wang.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

